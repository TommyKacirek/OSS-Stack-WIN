# Cybersecurity Lab Deployment Report

## 1. Project Overview
- **Status**: **OPERATIONAL ðŸŸ¢**
- **Deployment Date**: 2025-12-21
- **Platform**: Ubuntu 24.10 VM
- **Stack**: 
  - **Wazuh Manager/Indexer/Dashboard**: Dockerized (v4.7.2)
  - **Suricata NIDS**: Dockerized (v8.0.2), Host Network Mode
  - **Wazuh Agent**: Host-native (v4.7.2)

## 2. Architecture & Integration
The lab implements a hybrid monitoring strategy:
- **NIDS**: Suricata captures raw traffic on `ens33` and generates `eve.json` in a Docker volume (`suricata_logs`).
- **Data Ingestion**: The Wazuh Manager container bind-mounts the `suricata_logs` volume at `/var/log/suricata/`, allowing `wazuh-logcollector` to tail `eve.json` in real-time.
- **Host Monitoring**: A native Wazuh Agent is registered with the Manager (ID 001) for FIM, Syslog, and Inventory monitoring.
- **Persistence**: Core configurations (`ossec.conf`, `suricata.yaml`) are externalized to `/opt/lab/` for easy modification and persistence.

## 3. Critical Fixes & Lessons Learned
During deployment, several non-trivial obstacles were resolved to achieve "Production-Ready" status:
- **JSON Decoder Bottleneck**: 
  - *Problem*: Suricata events were dropped by Wazuh with error `Too many fields for JSON decoder`.
  - *Fix*: Created `/var/ossec/etc/local_internal_options.conf` and set `analysisd.decoder_order_size=1024`.
- **Filebeat Indexing Pipeline**:
  - *Problem*: Filebeat couldn't push alerts due to SSL hostname mismatch (`demo.indexer`) and 401 Unauthorized.
  - *Fix*: Disabled SSL verification (`verification_mode: none`) and switched to `labuser` credentials.
- **Agent Versioning**:
  - *Problem*: Default `apt` version (4.14) was newer than Manager (4.7).
  - *Fix*: Downgraded host agent to `4.7.2` and customized `ossec.conf` to remove incompatible tags like `journald` and `syscollector:users`.
- **Suricata Signature Engine**:
  - *Problem*: Suricata was observing traffic but not triggering security alerts.
  - *Fix*: Populated rule database with `suricata-update` and performed a live reload of `suricata.rules`.

## 4. Verification Proof
The detection pipeline was verified via "Live Fire" tests:
### Commands executed:
```bash
# Test 1: Network Signature Detection
curl -A "BlackSun" http://testmyids.com

# Test 2: Host Anomaly Detection
logger "VERIFICATION_TEST: Triggering manual syslog alert"
```
### Result Summary:
- **Suricata**: Logged `SURICATA Ethertype unknown` and IDS signatures in `eve.json`.
- **Wazuh**: Indexed events under Rule IDs `86601` (Suricata generic) and custom detections.
- **Dashboard**: Visible in **Security Events -> Discovery** with `data.event_type: alert`.

## 5. Access Information
- **Wazuh Dashboard**: [https://192.168.0.193:5601](https://192.168.0.193:5601)
- **Primary Credentials**: `labuser` / `SecretPassword123!`
- **Secondary (Recovery)**: `admin` / `admin` (if local hashes are synchronized)

### Support Note:
All Docker containers are managed via `docker-compose` in `/home/kaca/cybersecurity-serverB/`.
To restart the stack: `docker-compose restart`.

---
*Report generated by Antigravity AI.*
